!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(jQuery)}((function(t){"use strict";var i={none:"none",dark:"rgba(20, 20, 20, .6)",light:"rgba(250, 250, 250, .6)"},e=!1,o=!1;if(void 0===t||!t.hasOwnProperty("fn"))throw new Error("CropImage requires jQuery");function h(i){t(this).find(".R-container").append('<div class="R-error">'+i+"</div>"),setTimeout((()=>t(this).find(".R-container .R-error").remove()),8e3)}function n(i,n,a){var s,r,d,c={width:n.minWidth,height:n.minHeight};/x/.test(n.imgFormat)?(s=n.imgFormat.split("x"),c.width=Number(s[0]),c.height=Number(s[1]),e=!0,o=!1,t(this).find(".R-container [data-action]").hide()):/[1-9]\/[1-9]/.test(n.imgFormat)?(s=n.imgFormat.split("/"),c.width?c.height=c.width*(Number(s[1])/Number(s[0])):c.height&&(c.width=c.height*Number(s[0])/Number(s[1])),e=!1,o=!0,t(this).find(".R-container [data-action]").show(),t(this).find(".R-container [class^=R-side-]").hide()):(c.width=c.width||10,c.height=c.height||10,e=!1,o=!1,t(this).find(".R-container [data-action]").show()),[r,d]=n.cropRatio.split("/"),"ratio"==n.flixedCrop&&(o=!0),i.width>=c.width&&i.height>=c.height?a.call(this,{width:i.width,height:i.height,minWidth:c.width,minHeight:c.height,ratio:Number(r)/Number(d)}):h.call(this,"This image is smaller than "+c.width+"x"+c.height)}function a(a,s){var r,d=t.extend({image:!1,imgFormat:"auto",minWidth:0,minHeight:0,device:"all",circleCrop:!1,zoomable:!0,zoomMax:2,background:"transparent",inBoundGrid:!0,outBoundColor:"dark",btnDoneAttr:".R-container .R-btn-done",cropRatio:"1/1",flixedCrop:"none",isOnFloatingWindow:!1,isAutoDownsize:!1},a);t(this).html(function(t){return`<div class="R-container">\n\t\t\t\t\t\t\t\t<canvas class="rawStatCanvas" style="display: none;"></canvas>\n\t\t\t\t\t\t\t\t<canvas class="rawDynaCanvas" style="display: none;"></canvas>\n\t\t\t\t\t\t\t\t<div class="R-cover"></div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div class="R-adapter">\n\t\t\t\t\t\t\t\t\t<canvas class="statCanvas"></canvas>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<div class="R-cropper ${t.circleCrop?"circle":""} ${t.noBorder?"":"border"}">\n\t\t\t\t\t\t\t\t\t\t<canvas class="dynaCanvas"></canvas>\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t${t.inBoundGrid?'<div class="R-grid">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="R-col-1"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="R-col-2"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="R-col-3"></div>\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="R-raw-1"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="R-raw-2"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="R-raw-3"></div>\n\t\t\t\t\t\t\t\t\t\t\t</div>':""}\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t<div class="R-corner-lt" data-action="lt-crop"></div>\n\t\t\t\t\t\t\t\t\t\t<div class="R-corner-rt" data-action="rt-crop"></div>\n\t\t\t\t\t\t\t\t\t\t<div class="R-corner-rb" data-action="rb-crop"></div>\n\t\t\t\t\t\t\t\t\t\t<div class="R-corner-lb" data-action="lb-crop"></div>\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t<div class="R-side-left" data-action="l-crop"></div>\n\t\t\t\t\t\t\t\t\t\t<div class="R-side-top" data-action="t-crop"></div>\n\t\t\t\t\t\t\t\t\t\t<div class="R-side-right" data-action="r-crop"></div>\n\t\t\t\t\t\t\t\t\t\t<div class="R-side-bottom" data-action="b-crop"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}(d));let c=null,g=t(this).find(".R-container"),p=t(this).find(".R-adapter"),l=t(this).find(".R-cropper"),w=t(this).find(".R-cover"),f=t(this).find('[class^="R-side-"], [class^="R-corner-"]'),u=null,m=null,v=null,x=null,b=null,R=null;function y(i){d.image=i,c=new Image,"file:"==window.location.protocol?console.warn("[CropImage] - Exporting cropped image might not work because of <file://> protocol"):c.crossOrigin="*",c.onerror=function(t){console.error(`Error loading the image: ${t}`)},c.onload=()=>{n.call(this,c,d,k),t(window).on("resize",(()=>n.call(this,c,d,k)))},r=c.src=function(t){return"string"!=typeof t?window.URL.createObjectURL(t):t}(d.image),g.addClass(d.background),g.find(".R-error").remove()}function I(t,i=!1){return d.noBorder?t:t+(i?2:-4)}function C(t,i=!1){return d.noBorder?t:t-(i?2:-4)}function k(h){m=this.find(".rawDynaCanvas")[0],u=this.find(".dynaCanvas")[0],x=this.find(".rawStatCanvas")[0],v=this.find(".statCanvas")[0],b=v.getContext("2d"),R=u.getContext("2d"),R.imageSmoothingEnabled=!0,R.imageSmoothingQuality="high",function(t,i,e,o){var h,n,a=t.width,s=t.height,r=1;(a*=i.height()/t.height)>i.width()&&(a=i.width()),(s*=i.width()/t.width)>i.height()&&(s=i.height()),h=(i.height()-s)/2,n=(i.width()-a)/2,e.isAutoDownsize||(r=a>s?Math.min(a/t.width,r):Math.min(s/t.height,r)),o({width:a,height:s,origWidth:t.width,origHeight:t.height,scale:r,left:n,top:h,HzImage:t.width!=t.height?t.width>t.height:null})}(h,g,d,(function(n){v.width=n.width,v.height=n.height,b.scale(n.scale,n.scale),w.css({left:n.left+"px",top:n.top+"px",right:n.left+"px",bottom:n.top+"px",background:i[i.hasOwnProperty(d.outBoundColor)?d.outBoundColor:"dark"]}),function(t,i,e){var o,h,n=i.width,a=i.height,s=t.minWidth*i.scale,r=t.minHeight*i.scale;if(t.ratio){var d=n/t.ratio,c=a*t.ratio;d<=a?(o=n,h=d):(o=c,h=a)}else s&&r?s<=n&&r<=a?(o=s,h=r):s>n?(o=n,h=r*(n/s)):(h=a,o=s*(a/minHeigh)):(o=n,h=a);e({width:o,height:h,left:(n-o)/2,top:(a-h)/2})}(h,n,(function(i){l.css({width:u.width=I(i.width),height:u.height=I(i.height),left:i.left+"px",top:i.top+"px"});var a=n.width-u.width,r=n.height-u.height,g=0+n.width,y=0+n.height,k=h.minWidth||l.width()/2,D=h.minHeight||l.height()/2,z=!1,H={width:n.width,height:n.height,left:0,top:0},M={},E={},W={},X=!0,Y=0,A=1;function j(t,i,e){var o=Math.min(I(a),Math.max(0,(e?t.originalEvent.touches[0].clientX:t.pageX)-i.x)),h=Math.min(I(r),Math.max(0,(e?t.originalEvent.touches[0].clientY:t.pageY)-i.y));l.css("left",o+"px"),l.css("top",h+"px"),A>1&&(b.clearRect(0,0,H.width,H.height),E.ox=i.ox=Math.floor((t.pageX-w.offset().left)/n.scale),E.oy=i.oy=Math.floor((t.pageY-w.offset().top)/n.scale),b.drawImage(c,-i.ox*Y,-i.oy*Y,H.width,H.height)),R.drawImage(v,I(o,!0),I(h,!0),l.width(),l.height(),0,0,l.width(),l.height())}function B(i,e,a){var s,r,c=(a?i.originalEvent.touches[0].pageX:i.pageX)-l.offset().left,w=(a?i.originalEvent.touches[0].pageY:i.pageY)-l.offset().top,f=(a?i.originalEvent.touches[0].clientX:i.clientX)-p.offset().left,m=(a?i.originalEvent.touches[0].clientY:i.clientY)-(p.offset().top-(d.isOnFloatingWindow?t(window).scrollTop():0)),x=l.height()/l.width();switch(e.t.data("action")){case"l-crop":if(s=l.width()-c,0<=f&&s>k){if("ratio"!=d.flixedCrop)l.css({width:s+"px",left:f+"px"}),u.width=s;else{if((r=s*x)<D)break;const t=n.height-l.position().top;t<r&&(s-=(r-t)/x,r=t,f=l.position().left),l.css({width:s+"px",height:r+"px",left:f+"px"}),u.width=s,u.height=r}R.drawImage(v,I(f,!0),I(l.position().top,!0),s,l.height(),0,0,s,l.height())}break;case"r-crop":if(s=c,I(g)>=f&&s>k){if("ratio"!=d.flixedCrop)l.css("width",s+"px"),u.width=s;else{if((r=s*x)<D)break;const t=n.height-l.position().top;t<r&&(s-=(r-t)/x,r=t),l.css({width:s+"px",height:r+"px"}),u.width=s,u.height=r}R.drawImage(v,I(l.position().left,!0),I(l.position().top,!0),s,l.height(),0,0,s,l.height())}break;case"t-crop":if(r=l.height()-w,0<=m&&r>D){if("ratio"!=d.flixedCrop)l.css({height:r+"px",top:m+"px"}),u.height=r;else{if((s=r/x)<k)break;const t=n.width-l.position().left;t<s&&(r-=(s-t)*x,s=t,m=l.position().top),l.css({width:s+"px",height:r+"px",top:m+"px"}),u.width=s,u.height=r}R.drawImage(v,I(l.position().left,!0),m,I(l.width(),!0),r,0,0,l.width(),r)}break;case"b-crop":if(r=w,I(y)>=m&&r>D){if("ratio"!=d.flixedCrop)l.css("height",r+"px"),u.height=r;else{if((s=r/x)<k)break;const t=n.width-l.position().left;t<s&&(r-=(s-t)*x,s=t),l.css({width:s+"px",height:r+"px"}),u.width=s,u.height=r}R.drawImage(v,I(l.position().left,!0),I(l.position().top,!0),l.width(),r,0,0,l.width(),r)}break;case"lt-crop":s=l.width()-c,r=l.height()-w,o?0<=f&&s>k&&(r=s/h.ratio,0<=(m=e.topHeight-r)&&m<=I(n.height-r)&&r>D&&(l.css({width:s+"px",height:r+"px",left:f+"px",top:m+"px"}),u.width=s,u.height=r,R.drawImage(v,I(f,!0),I(m,!0),s,r,0,0,s,r))):(0<=f&&s>k&&(l.css({width:s+"px",left:f+"px"}),u.width=s,R.drawImage(v,I(f,!0),I(l.position().top,!0),s,l.height(),0,0,s,l.height())),0<=m&&r>D&&(l.css({height:r+"px",top:m+"px"}),u.height=r,R.drawImage(v,I(l.position().left,!0),I(m,!0),l.width(),r,0,0,l.width(),r)));break;case"lb-crop":s=l.width()-c,r=w,o?0<=f&&s>k&&(r=s/h.ratio,I(y)>=m&&r>D&&r<I(n.height-l.position().top)&&(l.css({width:s+"px",height:r+"px",left:f+"px"}),u.width=s,u.height=r,R.drawImage(v,I(f,!0),I(l.position().top,!0),s,r,0,0,s,r))):(0<=f&&s>k&&(l.css({width:s+"px",left:f+"px"}),u.width=s,R.drawImage(v,I(f,!0),I(l.position().top,!0),s,l.height(),0,0,s,l.height())),I(y)>=m&&r>D&&(l.css("height",r+"px"),u.height=r,R.drawImage(v,I(l.position().left,!0),I(l.position().top,!0),l.width(),r,0,0,l.width(),r)));break;case"rt-crop":s=c,r=l.height()-w,o?I(g)>=f&&s>k&&(r=s/h.ratio,0<=(m=e.topHeight-r)&&r>D&&(l.css({width:s+"px",height:r+"px",top:m+"px"}),u.width=s,u.height=r,R.drawImage(v,I(l.position().left,!0),I(m,!0),s,r,0,0,s,r)),e.lastLeft=f):(I(g)>=f&&s>k&&(l.css("width",s+"px"),u.width=s,R.drawImage(v,I(l.position().left,!0),I(l.position().top,!0),s,l.height(),0,0,s,l.height())),0<=m&&r>D&&(l.css({height:r+"px",top:m+"px"}),u.height=r,R.drawImage(v,I(l.position().left,!0),I(m,!0),l.width(),r,0,0,l.width(),r)));break;case"rb-crop":s=c,r=w,o?I(g)>=f&&s>k&&(r=s/h.ratio,I(y)>=m&&r>D&&r<I(n.height-l.position().top)&&(l.css({width:s+"px",height:r+"px"}),u.width=s,u.height=r,R.drawImage(v,I(l.position().left,!0),I(l.position().top,!0),s,r,0,0,s,r))):(I(g)>=f&&s>k&&(l.css("width",s+"px"),u.width=s,R.drawImage(v,I(l.position().left,!0),I(l.position().top,!0),s,l.height(),0,0,s,l.height())),I(y)>=m&&r>D&&(l.css("height",r+"px"),u.height=r,R.drawImage(v,I(l.position().left,!0),I(l.position().top,!0),l.width(),r,0,0,l.width(),r)))}}function N(){z=!1,M={},W={}}setTimeout((()=>{b.drawImage(c,0,0,d.isAutoDownsize?n.width:n.origWidth,d.isAutoDownsize?n.height:n.origHeight),p.css({left:n.left,top:n.top,width:n.width,height:n.height}),R.drawImage(v,I(i.left,!0),I(i.top,!0),i.width,i.height,0,0,i.width,i.height)}),10),l.mousedown((function(t){z||(M.t=l,M.x=t.pageX-l.position().left,M.y=t.pageY-l.position().top),a=n.width-l.width(),r=n.height-l.height()})).dblclick((function(t){d.zoomable&&(1==A&&(X=!0),A>d.zoomMax-.5&&(X=!1),E.ox=M.ox=Math.floor(t.pageX-w.offset().left),E.oy=M.oy=Math.floor(t.pageY-w.offset().top),function(t){b.clearRect(0,0,H.width,H.height),t&&A<d.zoomMax?A++:A>1&&A--;H.width=(d.isAutoDownsize?n.width:n.origWidth)*A,H.height=(d.isAutoDownsize?n.height:n.origHeight)*A,Y=A-(A>1?A/2:0),H.left=A>1?-M.ox*Y:0,H.top=A>1?-M.oy*Y:0,b.drawImage(c,H.left,H.top,H.width,H.height),R.drawImage(v,I(l.position().left,!0),I(l.position().top,!0),l.width(),l.height(),0,0,l.width(),l.height())}(X))})).touchstart((function(t){z||(M.t=l,M.x=t.originalEvent.touches[0].clientX-l.position().left,M.y=t.originalEvent.touches[0].clientY-l.position().top),a=n.width-l.width(),r=n.height-l.height()})),f.mousedown((function(i){z=!0,W.t=t(this),W.topHeight=l.position().top+l.height()})),t(document).mouseup((function(){N()})).mousemove((function(t){t.preventDefault(),!e&&W.t&&B(t,W)})).touchend((function(){N()})),p.mousemove((function(t){t.preventDefault(),M.t&&j(t,M)})).touchmove((function(t){t.preventDefault(),M.t?j(t,M,!0):W.t&&(W.x||W.y)&&B(t,W,!0)})),t(d.btnDoneAttr).click((function(){if("function"!=typeof s)return;let t=v,i=I(l.position().left,!0),e=I(l.position().top,!0);const o=Math.round(C(l.width())/n.scale),h=Math.round(C(l.height())/n.scale);if(m.width=o,m.height=h,!d.isAutoDownsize){let o=0,h=0,a=n.origWidth,s=n.origHeight;t=x,x.width=n.origWidth,x.height=n.origHeight,A>1&&(o=-E.ox*Y,h=-E.oy*Y,a=H.width,s=H.height),i/=n.scale,e/=n.scale,x.getContext("2d").drawImage(c,o,h,a,s)}m.getContext("2d").drawImage(t,i,e,o,h,0,0,o,h),s(m.toDataURL("image/jpeg"))}))}))}))}return d.image&&y.call(this,d.image),"size"==d.flixedCrop&&f.hide(),{setImage:y,getImage:(t="jpeg")=>{if(r)return u.toDataURL("image/"+t.toLowerCase());h.call(this,"Configuration Error: Undefined image URL or blob image file")},reset:function(){d.image=!1,r="",c=null,b.clearRect(0,0,b.canvas.width,b.canvas.height),R.clearRect(0,0,R.canvas.width,R.canvas.height),g.find(".R-error").remove()}}}return t.fn.cropimage=a,t.fn.extend({touchend:function(t){return t?this.bind("touchend",t):this.trigger("touchend")},touchstart:function(t){return t?this.bind("touchstart",t):this.trigger("touchstart")},touchmove:function(t){return t?this.bind("touchmove",t):this.trigger("touchmove")}}),a}));